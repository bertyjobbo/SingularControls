<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Testing SingularControls</title>
    <script src="Scripts/angular.js"></script>
    <script src="Scripts/angular-route.js"></script>
    <script src="SgControls/sgcontrols.js"></script>
    <script>
        'use strict';

        // create namespace
        var SingularControls = {};

        // create
        SingularControls.TestApp = angular.module("SingularControls.TestApp", ['ngRoute', 'sgControls']);

        // closure
        (function (app) {

            // configure routes
            app.config(['$routeProvider', function ($routeProvider) {

                $routeProvider
                    .when("/", { templateUrl: "Ng/Views/Home.html", controller: "homeController" })
                    .when("/about", { templateUrl: "Ng/Views/About.html", controller: "aboutController" });

            }]);

            // configure forms stuff
            app.config(['sgControlsConfigProvider', function (sgControlsConfigProvider) {

                // config
                sgControlsConfigProvider

                    // add wrapper
                    .addControlWrapper("sgAll", function (label, control) {
                        return "<p>" + label + "<span>" + control + "</span></p>";
                    })

                    // add translation method promise
                    .setTranslationRequestPromise(function (requests, $http) {

                        // TODO - how do you get languageCode?
                        var langCode = "en-GB";
                        return $http.post("/api/translation/translations/" + langCode.toLowerCase(), requests);

                    })

                    // set translation cache length
                    .setMaxTranslationCacheLength(1000);

            }]);


            // controllers
            app
                .controller("homeController", ["$scope", "sgTranslationService", function ($scope, sgTranslationService) {

                    $scope.GetData = function () {
                        return {
                            call: "dummy", data: "here"
                        };
                    };

                    $scope.LabelFromCache = "NOT WORKED";
                    sgTranslationService.getTranslations(["Common:Label from controller"]).then(function (data) {
                        $scope.LabelFromCache = data["Common:Label from controller"];
                    });

                }])
                .controller("aboutController", ["$scope", "sgTranslationService", function ($scope, sgTranslationService) {

                    $scope.LabelFromCache = "NOT WORKED";
                    sgTranslationService.getTranslations(["Common:Label from controller"]).then(function (data) {
                        $scope.LabelFromCache = data["Common:Label from controller"];
                    });

                }]);

        })(SingularControls.TestApp);


    </script>
</head>
<body ng-app="SingularControls.TestApp">
    <h1>Test</h1>
    <section ng-view=""></section>
</body>
</html>
